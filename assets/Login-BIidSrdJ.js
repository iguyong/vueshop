import{_ as I,f as x,r as w,g as b,c as f,a as s,d as y,e as _,b as B,w as m,v,t as S,s as F,o as g}from"./index-Bv4Am3CP.js";let C=[];const N=()=>Promise.resolve(C),O=l=>Promise.resolve(C=[...l]),D={getCart:N,updateCart:O},M=[{id:1,name:"产品 A",price:100,onSale:!0},{id:2,name:"产品 B",price:200,onSale:!1},{id:3,name:"产品 C",price:150,onSale:!0},{id:4,name:"产品 D",price:100,onSale:!0},{id:5,name:"产品 E",price:200,onSale:!1},{id:6,name:"产品 F",price:150,onSale:!0},{id:7,name:"产品 G",price:100,onSale:!0},{id:8,name:"产品 H",price:200,onSale:!1},{id:9,name:"产品 I",price:150,onSale:!0},{id:10,name:"产品 J",price:100,onSale:!0},{id:11,name:"产品 K",price:200,onSale:!1},{id:12,name:"产品 L",price:150,onSale:!0}],T=()=>M,z={getProducts:T},E=async l=>await new Promise(u=>{setTimeout(()=>{u({data:{id:Date.now()+"",total:l.total,items:l.items,createdAt:Date.now()}})},1500)}),J=async l=>E(l),L={createOrder:J},R=l=>new Promise((c,u)=>{const{username:d,password:t,is_register:r}=l,n=JSON.parse(localStorage.getItem("users")||"[]"),i=n.find(p=>p.username===d);if(i)r?u("用户已存在"):i.password===t?c(i):u("密码错误");else if(r){const p={username:d,password:t};n.push(p),localStorage.setItem("users",JSON.stringify(n)),c(p)}else u("用户不存在")}),A={login:R},h={user:A,products:z,cart:D,order:L},G={class:"login-container"},H={class:"auth-box"},K={class:"tabs"},q={class:"form-group"},Q={class:"form-group"},W={key:0,class:"form-group"},X={class:"alert"},Y={class:"form-group"},Z={class:"form-group"},j={class:"code-input"},ee=["disabled"],se={type:"submit",class:"submit-btn"},te={__name:"Login",setup(l){const c=x(),u=F(),d=w("password"),t=b({username:"",password:"",password2:""}),r=b({phone:"",code:""}),n=w(0),i=w(""),p=w("login"),k=async()=>{if(!$())return;let o=null;try{p.value==="register"?t.password!==t.repeatPassword?i.value="两次密码不一致":o=await h.user.login({...t,is_register:!0}):(o=await h.user.login({...t,is_register:!1}),u.push("/")),o&&(c.setUser(o),u.push("/"))}catch(e){i.value=e,e==="用户不存在"&&(p.value="register")}},P=async()=>{if(U())try{await $api.loginBySms(r)}catch(o){o.code==="USER_NOT_FOUND"&&(await $api.registerBySms(r),i.value="新用户注册成功",setTimeout(()=>i.value="",3e3))}},V=async()=>{if(!/^1[3-9]\d{9}$/.test(r.phone))return alert("请输入有效手机号");await user.sendSMSCode(r.phone),n.value=60;const o=setInterval(()=>{n.value<=0?clearInterval(o):n.value--},1e3)},$=()=>{const o=/^(\w+@[a-z0-9]+\.[a-z]{2,4}|1[3-9]\d{9})$/.test(t.username),e=t.password.length>=6;return o&&e},U=()=>{const o=/^1[3-9]\d{9}$/.test(r.phone),e=/^\d{6}$/.test(r.code);return o&&e};return(o,e)=>(g(),f("div",G,[s("div",H,[s("div",K,[s("button",{class:y({active:d.value==="password"}),onClick:e[0]||(e[0]=a=>d.value="password")},"密码登录",2),s("button",{class:y({active:d.value==="sms"}),onClick:e[1]||(e[1]=a=>d.value="sms")},"短信登录",2)]),d.value==="password"?(g(),f("form",{key:0,onSubmit:_(k,["prevent"])},[s("div",q,[e[7]||(e[7]=s("label",null,"邮箱/手机号",-1)),m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.username=a),placeholder:"请输入邮箱或手机号"},null,512),[[v,t.username]])]),s("div",Q,[e[8]||(e[8]=s("label",null,"密码",-1)),m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.password=a),type:"password",placeholder:"至少6位密码"},null,512),[[v,t.password]])]),p.value=="register"?(g(),f("div",W,[e[9]||(e[9]=s("label",null,"重复密码",-1)),m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.repeatPassword=a),type:"password",placeholder:"至少6位密码"},null,512),[[v,t.repeatPassword]])])):B("",!0),e[10]||(e[10]=s("button",{type:"submit",class:"submit-btn"}," 登录/注册 ",-1)),s("div",X,S(i.value),1)],32)):(g(),f("form",{key:1,onSubmit:_(P,["prevent"])},[s("div",Y,[e[11]||(e[11]=s("label",null,"手机号",-1)),m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.phone=a),placeholder:"请输入11位手机号",maxlength:"11"},null,512),[[v,r.phone]])]),s("div",Z,[e[12]||(e[12]=s("label",null,"验证码",-1)),s("div",j,[m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.code=a),placeholder:"6位验证码",maxlength:"6"},null,512),[[v,r.code]]),s("button",{type:"button",disabled:n.value>0,onClick:V},S(n.value?`${n.value}s后重发`:"获取验证码"),9,ee)])]),s("button",se,S(o.smsIsRegistering?"验证码注册":"验证码登录"),1)],32))])]))}},re=I(te,[["__scopeId","data-v-7e96c03d"]]);export{re as default};
